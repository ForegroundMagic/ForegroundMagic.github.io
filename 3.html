<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <!-- Mobile viewport: allow full-bleed content and correct scaling -->
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="color-scheme" content="light dark" />
  <title>Responsive Mobile Editor</title>

  <!-- Material Symbols (compact icon set) -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />

  <style>
    /* ------------------------------------------------------------
       0) DESIGN TOKENS (easy knobs for layout and theming)
       ------------------------------------------------------------ */
    :root{
      /* Vertical stack proportions (portrait). These are used by flex. */
      --header-h: 5%;
      --preview-h: 60%;
      --controls-h: 35%;

      /* Landscape fallback (overridden by media query). */
      --header-h-land: 10%;
      --preview-h-land: 55%;
      --controls-h-land: 35%;

      /* Internal splits inside the controls panel */
      --controls-top: 15%;
      --controls-mid: 60%;
      --controls-bot: 25%;

      /* Typography scale */
      --fs-sm: clamp(.85rem, 2.8vw, 1rem);
      --fs-md: clamp(.95rem, 3.5vw, 1.125rem);
      --fs-lg: clamp(1.05rem, 4.5vw, 1.25rem);

      /* Spacing */
      --gap-1: .5rem;
      --gap-2: .75rem;
      --gap-3: 1rem;

      /* Colors */
      --bg-page: #f5f6f8;
      --bg-app: #e7ebf0;
      --bg-header: #2196f3;
      --ink-on-header: #fff;

      --ctrl-top:    #ffe0b2;
      --ctrl-mid:    #ffe082;
      --ctrl-bot:    #ffcc80;

      --toolbar-card: #fff;
      --toolbar-ink:  #222;

      /* Frame + design overlay styles */
      --frame-stroke: rgba(255,255,255,.95);
      --frame-stroke-w: 2.5;
      --frame-dash: 7 6;
      --design-fill: rgba(255,255,255,.22);
      --design-stroke: rgba(255,255,255,.45);
      --design-stroke-w: 1.5;

      /* Toolbar sizing */
      --tool-gap: 16px;
      --tool-pad: 12px;
      --tool-icon-box: 40px;
      --tool-icon-size: 28px;
      --tool-radius: 14px;

      /* Dynamic viewport fallback var populated by JS.
         We always prefer dvh/svh where supported. */
      --dvh: 100vh;
    }

    /* Respect reduced-motion users. */
    @media (prefers-reduced-motion: reduce){
      * { animation: none !important; transition: none !important; }
    }

    /* ------------------------------------------------------------
       1) PAGE RESET / BASICS
       ------------------------------------------------------------ */
    *, *::before, *::after { box-sizing: border-box; }
    html, body {
      height: 100%;
      margin: 0;
      background: var(--bg-page);
      font: 400 16px/1.35 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    /* Avoid whole-page scrolling; scroll within panels if needed. */
    body { overflow: hidden; }

    /* ------------------------------------------------------------
       2) APP SHELL
       - Uses dynamic viewport height that tracks the *visible* area.
       - dvh has universal support on modern mobile; JS sets --dvh as
         a fallback for older browsers (e.g., older iOS Safari).
       ------------------------------------------------------------ */
    .app {
      /* Prefer dvh (dynamic), fall back to svh (small) then 100vh,
         then JS-provided --dvh for legacy. */
      height: 100dvh;
      height: 100svh;
      height: var(--dvh);
      /* Full-bleed with safe-area awareness (notch devices). */
      padding: env(safe-area-inset-top) env(safe-area-inset-right)
               env(safe-area-inset-bottom) env(safe-area-inset-left);
      margin: 6px;
      background: var(--bg-app);
      border-radius: 16px;
      box-shadow: 0 8px 28px rgba(0,0,0,.12);
      display: flex;
      flex-direction: column;
      gap: var(--gap-1);
      overflow: hidden; /* children manage their own scrolling */
    }

    /* ------------------------------------------------------------
       3) REGIONS (stacked vertically using flex-basis %)
       ------------------------------------------------------------ */
    .region--header{
      flex: 0 0 var(--header-h);
      min-height: 44px; /* touch target minimum */
      border-radius: 12px;
      background: var(--bg-header);
      color: var(--ink-on-header);
      display: grid;
      place-items: center;
      padding-inline: var(--gap-2);
      font-weight: 700;
      font-size: var(--fs-lg);
    }

    .region--preview{
      flex: 0 0 var(--preview-h);
      border-radius: 10px;
      overflow: hidden; /* ensures overlays don’t bleed */
      display: grid;
      place-items: stretch;
      background: transparent;
    }

    .viewport{
      position: relative;
      width: 100%;
      height: 100%;
      overflow: hidden;
      /* no border/background to avoid clash with the design image */
    }

    /* Main SVG scene */
    .scene{
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      display: block;
      pointer-events: none;
    }
    /* Separate overlay for frame to guarantee pixel-accurate stroke */
    .frame{
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      display: none;
      pointer-events: none;
    }
    .viewport.show-frame .frame{ display: block; }

    .frameRect{
      fill: none;
      stroke: var(--frame-stroke);
      stroke-width: var(--frame-stroke-w);
      stroke-dasharray: var(--frame-dash);
      vector-effect: non-scaling-stroke;
    }

    .design-layer{ display: none; }
    .viewport.show-design .design-layer{ display: block; }

    /* ------------------------------------------------------------
       4) CONTROLS PANEL
       ------------------------------------------------------------ */
    .region--controls{
      flex: 0 0 var(--controls-h);
      display: flex;
      flex-direction: column;
      gap: var(--gap-1);
      border-radius: 12px;
      overflow: hidden; /* keeps rounded corners when inner scrolls */
    }

    .controls-top{
      flex: 0 0 var(--controls-top);
      min-height: 48px;
      background: var(--ctrl-top);
      display: grid;
      place-items: center;
      padding-inline: var(--gap-2);
    }

    .controls-mid{
      flex: 0 0 var(--controls-mid);
      background: var(--ctrl-mid);
      display: grid;
      place-items: center;
      padding: var(--gap-2);
      overflow: auto; /* only this section scrolls if needed */
    }

    .controls-bot{
      flex: 0 0 var(--controls-bot);
      background: var(--ctrl-bot);
      padding: var(--tool-pad);
      display: grid;
      align-items: center;
    }

    /* ---- Top row (5-column layout) ---- */
    .top-grid{
      width: min(100%, 960px);
      display: grid;
      grid-template-columns: 30% 10% 20% 10% 30%;
      gap: var(--gap-2);
      align-items: center;
    }
    .top-col{ display: grid; place-items: center; }

    /* View switch (Preview/Edit) */
    .view-switch{
      display: inline-flex;
      align-items: center;
      gap: .6rem;
      padding: .5rem .8rem;
      border-radius: 999px;
      background: #fff;
      box-shadow: 0 1px 0 rgba(0,0,0,.06);
      font-weight: 700;
      font-size: var(--fs-sm);
      user-select: none;
    }
    .switch{
      --h: 22px; --w: 42px;
      position: relative; width: var(--w); height: var(--h);
    }
    .switch input{ display: none; }
    .slider{
      position:absolute; inset:0; border-radius:999px;
      background:#d7d7d7;
      transition: background .18s ease;
    }
    .slider::before{
      content:""; position:absolute; top:2px; left:2px;
      width:18px; height:18px; border-radius:50%;
      background:#fff; box-shadow: 0 1px 2px rgba(0,0,0,.25);
      transition: transform .18s ease;
    }
    .switch input:checked + .slider{ background:#222; }
    .switch input:checked + .slider::before{ transform: translateX(20px); }

    /* Adjust button (hidden in Preview, visible in Edit) */
    .btn-adjust{
      appearance: none; border: none; cursor: pointer;
      display: inline-flex; align-items: center; gap: .5rem;
      padding: .6rem .9rem; border-radius: 12px;
      background: #fff; color:#222; font-weight:700;
      font-size: var(--fs-sm);
      box-shadow: 0 1px 0 rgba(0,0,0,.06);
      visibility: hidden; opacity: 0; transform: translateY(-2px);
      transition: opacity .15s ease, transform .15s ease, visibility 0s .15s;
      min-height: 44px; /* touch target */
    }
    .app.is-edit .btn-adjust{
      visibility: visible; opacity: 1; transform: none; transition-delay: 0s;
    }

    .toggle-group{
      display: inline-flex; gap: 6px; padding: 4px;
      background: rgba(0,0,0,.05); border-radius: 999px;
    }
    .toggle{
      appearance: none; border: none; cursor: pointer;
      display: inline-flex; align-items: center; gap: .4rem;
      padding: .55rem .75rem; border-radius: 999px;
      background: #fff; color: #222; font-weight: 700;
      font-size: var(--fs-sm);
      box-shadow: 0 1px 0 rgba(0,0,0,.06);
      min-height: 40px;
    }
    .toggle[aria-pressed="true"]{ background:#222; color:#fff; }

    .material-symbols-rounded{
      font-variation-settings:"FILL" 0,"wght" 500,"GRAD" 0,"opsz" 24;
    }

    /* ---- Bottom toolbar: seven evenly spaced buttons ---- */
    .toolbar{
      width: 100%; height: 100%;
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: var(--tool-gap);
    }
    .tool{
      appearance: none; border: none; cursor: pointer;
      background: var(--toolbar-card); color: var(--toolbar-ink);
      border-radius: var(--tool-radius);
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      gap: .35rem; padding: var(--tool-pad);
      min-height: 100%;
      box-shadow: 0 1px 0 rgba(0,0,0,.06);
      user-select: none; -webkit-tap-highlight-color: transparent;
      font-size: var(--fs-sm); font-weight: 700;
    }
    .tool:active{ transform: translateY(1px); }
    .tool:focus-visible{ outline: 2px solid rgba(0,0,0,.2); outline-offset: 2px; }

    .tool-icon{
      width: var(--tool-icon-box);
      height: var(--tool-icon-box);
      display: grid; place-items: center;
    }
    .tool-icon .material-symbols-rounded{ font-size: var(--tool-icon-size); }

    /* ------------------------------------------------------------
       5) RESPONSIVE TWEAKS
       - Landscape: rebalance regions so header is taller and
         preview/controls remain usable.
       - Very narrow devices: allow toolbar to wrap to 2 rows.
       ------------------------------------------------------------ */
    @media (orientation: landscape){
      .region--header{ flex-basis: var(--header-h-land); }
      .region--preview{ flex-basis: var(--preview-h-land); }
      .region--controls{ flex-basis: var(--controls-h-land); }
    }

    @media (max-width: 360px){
      .toolbar{
        grid-template-columns: repeat(4, 1fr);
        grid-auto-rows: 1fr; /* wraps to a second row if needed */
      }
    }

    /* Helpful labels */
    .region-label{ font-weight: 800; font-size: var(--fs-md); text-align:center; }
  </style>
</head>
<body>

  <!--
    APP ROOT
    - The entire app uses the dynamic viewport height to avoid
      the classic 100vh mobile bug. Safe-area insets are honored.
  -->
  <div id="app" class="app">
    <!-- Header -->
    <header class="region--header">
      <div class="region-label">Header Region (≈5%)</div>
    </header>

    <!-- Preview (SVG-based scene) -->
    <section class="region--preview" aria-label="Canvas preview">
      <div id="viewport" class="viewport mode-preview">
        <!-- Base scene (image + optional design overlay) -->
        <svg id="scene" class="scene" viewBox="0 0 1155 1155" preserveAspectRatio="xMidYMid meet" aria-hidden="true">
          <!-- Base image (replace with your asset path) -->
          <image href="assets/img/demo/product-preview.png"
                 x="0" y="0" width="1155" height="1155" preserveAspectRatio="none" />
          <!-- Optional design area -->
          <g id="designLayer" class="design-layer">
            <rect x="361" y="180" width="440" height="583"
                  fill="var(--design-fill)"
                  stroke="var(--design-stroke)"
                  stroke-width="var(--design-stroke-w)" />
          </g>
        </svg>

        <!-- Frame overlay kept separate for crisp dashed stroke -->
        <svg id="frame" class="frame" viewBox="0 0 1155 1155" preserveAspectRatio="xMidYMid meet" aria-hidden="true">
          <rect class="frameRect" x="361" y="180" width="440" height="583" />
        </svg>
      </div>
    </section>

    <!-- Controls -->
    <section class="region--controls" aria-label="Controls">
      <!-- Top row: view switch + adjust + overlay toggles -->
      <div class="controls-top">
        <div class="top-grid">
          <!-- Column 1: View switch -->
          <div class="top-col">
            <div class="view-switch" role="group" aria-label="View mode">
              <span>Preview</span>
              <label class="switch" aria-label="Toggle Edit Mode">
                <input id="modeSwitch" type="checkbox" />
                <span class="slider"></span>
              </label>
              <span>Edit</span>
            </div>
          </div>

          <!-- Column 2: spacer -->
          <div class="top-col"></div>

          <!-- Column 3: Adjust (Edit only) -->
          <div class="top-col">
            <button id="btnAdjust" class="btn-adjust" type="button" title="Adjust (Edit mode)">
              <span class="material-symbols-rounded" aria-hidden="true">edit</span>
              <span>Adjust</span>
            </button>
          </div>

          <!-- Column 4: spacer -->
          <div class="top-col"></div>

          <!-- Column 5: overlay toggles -->
          <div class="top-col">
            <div class="toggle-group" role="group" aria-label="Overlays">
              <button id="btnFrame" class="toggle" type="button" aria-pressed="false" title="Show/Hide Frame">
                <span class="material-symbols-rounded" aria-hidden="true">crop_free</span>
                <span>Frame</span>
              </button>
              <button id="btnDesign" class="toggle" type="button" aria-pressed="false" title="Show/Hide Design">
                <span class="material-symbols-rounded" aria-hidden="true">layers</span>
                <span>Design</span>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Middle: your future controls -->
      <div class="controls-mid">
        <div class="region-label">Future Controls (custom UI goes here)</div>
      </div>

      <!-- Bottom: 7-button toolbar -->
      <div class="controls-bot">
        <div class="toolbar" role="toolbar" aria-label="Editor toolbar">
          <button class="tool" id="toolProduct" title="Product">
            <span class="tool-icon"><span class="material-symbols-rounded">storefront</span></span>
            <span>Product</span>
          </button>
          <button class="tool" id="toolColors" title="Colors">
            <span class="tool-icon"><span class="material-symbols-rounded">palette</span></span>
            <span>Colors</span>
          </button>
          <button class="tool" id="toolDesigns" title="Designs">
            <span class="tool-icon"><span class="material-symbols-rounded">auto_awesome</span></span>
            <span>Designs</span>
          </button>
          <button class="tool" id="toolElements" title="Elements">
            <span class="tool-icon"><span class="material-symbols-rounded">widgets</span></span>
            <span>Elements</span>
          </button>
          <button class="tool" id="toolText" title="Text">
            <span class="tool-icon"><span class="material-symbols-rounded">text_fields</span></span>
            <span>Text</span>
          </button>
          <button class="tool" id="toolLayers" title="Layers">
            <span class="tool-icon"><span class="material-symbols-rounded">layers</span></span>
            <span>Layers</span>
          </button>
          <button class="tool" id="toolExport" title="Export">
            <span class="tool-icon"><span class="material-symbols-rounded">ios_share</span></span>
            <span>Export</span>
          </button>
        </div>
      </div>
    </section>
  </div>

  <script>
    /* ============================================================
       JS: RESPONSIVE BEHAVIOR + VIEW/EDIT MODE
       ------------------------------------------------------------
       This is minimal, dependency-free, and heavily commented so
       it's easy to extend. It covers:
       - A safe fallback for dynamic viewport height on older iOS.
       - Toggling Preview/Edit while keeping frame/design overlays
         synchronized between the two SVGs (scene + frame).
       ============================================================ */

    // ---------- 1) Dynamic viewport height fallback ----------
    // Many modern browsers support 100dvh/100svh correctly. Older
    // Safari versions do not. We compute a CSS var (--dvh) equal to
    // the *visible* viewport height so our layout always fits.
    (function setDynamicVH(){
      const root = document.documentElement;
      const apply = (h) => root.style.setProperty('--dvh', h + 'px');

      // Prefer visualViewport when available (most accurate on mobile).
      const compute = () => {
        const h = (window.visualViewport && window.visualViewport.height)
          ? window.visualViewport.height
          : window.innerHeight;
        apply(h);
      };

      compute();
      window.addEventListener('resize', compute);
      window.addEventListener('orientationchange', compute);
      if (window.visualViewport) {
        window.visualViewport.addEventListener('resize', compute);
      }
    })();

    // ---------- 2) SVG / UI wiring ----------
    const app       = document.getElementById('app');
    const viewport  = document.getElementById('viewport');
    const sceneSvg  = document.getElementById('scene');
    const frameSvg  = document.getElementById('frame');
    const modeSwitch= document.getElementById('modeSwitch');
    const btnFrame  = document.getElementById('btnFrame');
    const btnDesign = document.getElementById('btnDesign');

    // Base image/view geometry
    const VIEWBOX_PREVIEW = { x:0, y:0, w:1155, h:1155 };
    const IMAGE_BOUNDS    = { x:0, y:0, w:1155, h:1155 };
    const DESIGN_RECT     = { x:361, y:180, w:440, h:583 };

    // Single source of truth for the current viewBox
    let currentViewBox = { ...VIEWBOX_PREVIEW };

    /** Utility: clamp a rect to the image bounds so we never show “off image”. */
    function clampRectToBounds(rect, bounds){
      let { x, y, w, h } = rect;
      if (w > bounds.w) w = bounds.w;
      if (h > bounds.h) h = bounds.h;
      if (x < bounds.x) x = bounds.x;
      if (y < bounds.y) y = bounds.y;
      if (x + w > bounds.x + bounds.w) x = bounds.x + bounds.w - w;
      if (y + h > bounds.y + bounds.h) y = bounds.y + bounds.h - h;
      return { x, y, w, h };
    }

    /**
     * Expand a rectangle by per-side offsets.
     * @param {Object} rect - base rect {x,y,w,h}
     * @param {Object} offsets - {top,right,bottom,left}
     * @returns clamped rect
     */
    function expandRectByOffsets(rect, offsets){
      const pad = { top:0, right:0, bottom:0, left:0, ...offsets };
      let x = rect.x - pad.left;
      let y = rect.y - pad.top;
      let w = rect.w + pad.left + pad.right;
      let h = rect.h + pad.top + pad.bottom;
      return clampRectToBounds({ x, y, w, h }, IMAGE_BOUNDS);
    }

    /** Build the Edit mode viewBox around the design rect with a margin. */
    function buildEditViewBox(offsets){
      return expandRectByOffsets(DESIGN_RECT, offsets);
    }

    /** Apply viewBox to both SVGs so overlays always align. */
    function setViewBox({x, y, w, h}) {
      const vb = `${x} ${y} ${w} ${h}`;
      sceneSvg.setAttribute('viewBox', vb);
      frameSvg.setAttribute('viewBox', vb);
      currentViewBox = { x, y, w, h };
    }

    /** Switch Preview/Edit modes.
     *  - Preview shows the full image.
     *  - Edit zooms to the design area with a small margin around it.
     */
    function setMode(isPreview){
      app.classList.toggle('is-edit', !isPreview);
      viewport.classList.toggle('mode-preview', isPreview);
      viewport.classList.toggle('mode-edit', !isPreview);

      const DEFAULT_EDIT_OFFSETS = { top: 25, right: 25, bottom: 25, left: 25 };
      const editVB = buildEditViewBox(DEFAULT_EDIT_OFFSETS);
      setViewBox(isPreview ? VIEWBOX_PREVIEW : editVB);
    }

    // Toggle helpers (pressed state + CSS class on the viewport)
    function togglePressed(btn){
      const now = btn.getAttribute('aria-pressed') !== 'true';
      btn.setAttribute('aria-pressed', String(now));
      return now;
    }
    btnFrame.addEventListener('click', () => {
      const on = togglePressed(btnFrame);
      viewport.classList.toggle('show-frame', on);
    });
    btnDesign.addEventListener('click', () => {
      const on = togglePressed(btnDesign);
      viewport.classList.toggle('show-design', on);
    });

    // Wire the Preview/Edit switch
    modeSwitch.addEventListener('change', () => {
      const isEdit = modeSwitch.checked;
      setMode(!isEdit ? true : false); // true -> Preview, false -> Edit
    });

    // ---- Initial state ----
    modeSwitch.checked = false; // start in Preview
    setMode(true);
  </script>
</body>
</html>
